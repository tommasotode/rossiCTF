# PyCalcolatrice 1.0 (`calc1`)

Alberto non ha voglia di fare lunghi calcoli manualmente durante le verifiche di matematica, quindi ha creato una calcolatrice che può usare di nascosto connettendosi con `nc <TODO: IP e porta>`, ma nello scorso compito non è stato abbastanza circospetto e al suo professore è sembrato di vedere che la stesse utilizzando. Aiuta il docente a rendere inutilizzabile la calcolatrice ~~trovando la flag~~ distruggendola!

## Istruzioni per creare la `chroot` jail

- Fai lo stesso di `calc2`, ma l'utente da creare è `calc1` con UID 10000 (o comunque diverso): `sudo useradd -d / -M -s /sbin/nologin -u 10000 -U calc1`;
- Per aggiungere la libreria `sympy` e la sua dependency `mpmath`, installale normalmente con `pip` e poi copia le due cartelle in `$stdlib_dir` (questa installazione minima non prevede `site-packages`, quindi bisogna metterle insieme ai moduli della stdlib): dovrebbe essere `pip install sympy && cp -r ~/${stdlib_dir/usr/.local}/site-packages/{sympy,mpmath} root/$stdlib_dir/`;
- Esegui `./main` finché non vengono fuori _solo_ i due `print` e l'`input`, sistemando gli errori di volta in volta; dovrebbero servire, nell'ordine, questi moduli:
  - `operator`: `cp $stdlib_dir/operator.py root/$stdlib_dir/`;
  - `bisect`: `cp $stdlib_dir/bisect.py root/$stdlib_dir/`;
  - `os`: `cp $stdlib_dir/os.py root/$stdlib_dir/` (sì, le due librerie lo richiedono effettivamente);
  - `stat`: `cp $stdlib_dir/stat.py root/$stdlib_dir/`;
  - `_collections_abc`: `cp $stdlib_dir/_collections_abc.py root/$stdlib_dir/`;
  - `posixpath`: `cp $stdlib_dir/posixpath.py root/$stdlib_dir/`;
  - `genericpath`: `cp $stdlib_dir/genericpath.py root/$stdlib_dir/`;
  - `__future__`: `cp $stdlib_dir/__future__.py root/$stdlib_dir/`;
  - `copy`: `cp $stdlib_dir/copy.py root/$stdlib_dir/`;
  - `types`: `cp $stdlib_dir/types.py root/$stdlib_dir/`;
  - `weakref`: `cp $stdlib_dir/weakref.py root/$stdlib_dir/`;
  - `_weakrefset`: `cp $stdlib_dir/_weakrefset.py root/$stdlib_dir/`;
  - `copyreg`: `cp $stdlib_dir/copyreg.py root/$stdlib_dir/`;
  - `warnings`: `cp $stdlib_dir/warnings.py root/$stdlib_dir/`;
  - `colorsys`: `cp $stdlib_dir/colorsys.py root/$stdlib_dir/`;
  - `functools`: `cp $stdlib_dir/functools.py root/$stdlib_dir/`;
  - `collections`: `cp -r $stdlib_dir/collections/ root/$stdlib_dir/`;
  - `keyword`: `cp $stdlib_dir/keyword.py root/$stdlib_dir/`;
  - `reprlib`: `cp $stdlib_dir/reprlib.py root/$stdlib_dir/`;
  - `re`: `cp $stdlib_dir/re.py root/$stdlib_dir/`;
  - `enum`: `cp $stdlib_dir/enum.py root/$stdlib_dir/`;
  - `sre_compile`: `cp $stdlib_dir/sre_compile.py root/$stdlib_dir/`;
  - `sre_parse`: `cp $stdlib_dir/sre_parse.py root/$stdlib_dir/`;
  - `sre_constants`: `cp $stdlib_dir/sre_constants.py root/$stdlib_dir/`;
  - `typing`: `cp $stdlib_dir/typing.py root/$stdlib_dir/`;
  - `contextlib`: `cp $stdlib_dir/contextlib.py root/$stdlib_dir/`;
  - `inspect`: `cp $stdlib_dir/inspect.py root/$stdlib_dir/`;
  - `ast`: `cp $stdlib_dir/ast.py root/$stdlib_dir/`;
  - `dis`: `cp $stdlib_dir/dis.py root/$stdlib_dir/`;
  - `opcode`: `cp $stdlib_dir/opcode.py root/$stdlib_dir/`;
  - `importlib`: `cp -r $stdlib_dir/importlib/ root/$stdlib_dir/`;
  - `linecache`: `cp $stdlib_dir/linecache.py root/$stdlib_dir/`;
  - `tokenize`: `cp $stdlib_dir/tokenize.py root/$stdlib_dir/`;
  - `token`: `cp $stdlib_dir/token.py root/$stdlib_dir/`;
  - `string`: `cp $stdlib_dir/string.py root/$stdlib_dir/`;
  - `struct`: `cp $stdlib_dir/struct.py root/$stdlib_dir/`;
  - `textwrap`: `cp $stdlib_dir/textwrap.py root/$stdlib_dir/`;
  - `timeit`: `cp $stdlib_dir/timeit.py root/$stdlib_dir/`;
  - `random`: `cp $stdlib_dir/random.py root/$stdlib_dir/`;
  - `threading`: `cp $stdlib_dir/threading.py root/$stdlib_dir/`;
  - `ctypes`: `cp -r $stdlib_dir/ctypes/ root/$stdlib_dir/`;
  - `_ctypes`: dovrebbe essere `cp $stdlib_dir/lib-dynload/_ctypes.cpython-3<versione>-x86_64-linux-gnu.so root/$stdlib_dir/lib-dynload/`;
  - Controlla le librerie richieste da `_ctypes` con `ldd $stdlib_dir/lib-dynload/_ctypes.cpython-3<versione>-x86_64-linux-gnu.so` e copia quelle mancanti; dovrebbe essere in più solo `libffi`: `cp /lib/x86_64-linux-gnu/libffi.so.8 root/lib/x86_64-linux-gnu/` (la versione potrebbe essere diversa);
  - `decimal`: `cp $stdlib_dir/decimal.py root/$stdlib_dir/`;
  - `_decimal`: dovrebbe essere `cp $stdlib_dir/lib-dynload/_decimal.cpython-3<versione>-x86_64-linux-gnu.so root/$stdlib_dir/lib-dynload/`;
  - Controlla le librerie richieste da `_decimal` con `ldd $stdlib_dir/lib-dynload/_decimal.cpython-3<versione>-x86_64-linux-gnu.so` e copia quelle mancanti; dovrebbe essere in più solo `libmpdec`: `cp /lib/x86_64-linux-gnu/libmpdec.so.3 root/lib/x86_64-linux-gnu/` (la versione potrebbe essere diversa);
  - `numbers`: `cp $stdlib_dir/numbers.py root/$stdlib_dir/`;
  - `fractions`: `cp $stdlib_dir/fractions.py root/$stdlib_dir/`;
  - `shutil`: `cp $stdlib_dir/shutil.py root/$stdlib_dir/`;
  - `fnmatch`: `cp $stdlib_dir/fnmatch.py root/$stdlib_dir/`;
  - `pathlib`: `cp $stdlib_dir/pathlib.py root/$stdlib_dir/`;
  - `ntpath`: `cp $stdlib_dir/ntpath.py root/$stdlib_dir/`;
  - `urllib`: `cp -r $stdlib_dir/urllib/ root/$stdlib_dir/`;
  - `ipaddress`: `cp $stdlib_dir/ipaddress.py root/$stdlib_dir/`;
  - `tempfile`: `cp $stdlib_dir/tempfile.py root/$stdlib_dir/`;
  - `subprocess`: `cp $stdlib_dir/subprocess.py root/$stdlib_dir/`;
  - `signal`: `cp $stdlib_dir/signal.py root/$stdlib_dir/`;
  - `selectors`: `cp $stdlib_dir/selectors.py root/$stdlib_dir/`.
